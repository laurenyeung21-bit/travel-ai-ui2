<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Travel Planner</title>
<style>
body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
.section { margin-bottom: 20px; }
.hidden { display: none; }
.typing { border-right: 2px solid #000; white-space: pre-wrap; animation: blink 0.7s steps(1) infinite; }
@keyframes blink { 50% { border-color: transparent; } }
</style>
</head>
<body>
<h1>AI Travel Planner</h1>

<div class="section">
<label for="duration">Duration (days):</label>
<input type="range" id="duration" min="14" max="21" value="15">
<span id="duration-display">15</span>
<br><br>

<label for="focus1">Focus 1:</label>
<select id="focus1">
<option value="Culture">Culture</option>
<option value="City">City</option>
<option value="Nature">Nature</option>
<option value="Beaches">Beaches</option>
</select>

<label for="focus2">Focus 2:</label>
<select id="focus2">
<option value="Culture">Culture</option>
<option value="City">City</option>
<option value="Nature">Nature</option>
<option value="Beaches">Beaches</option>
</select>
<br><br>

<label for="country1">Country 1:</label>
<select id="country1">
<option value="Argentina">Argentina</option>
<option value="Uruguay">Uruguay</option>
<option value="Brazil">Brazil</option>
<option value="Peru">Peru</option>
<option value="Chile">Chile</option>
</select>

<label for="country2">Country 2:</label>
<select id="country2">
<option value="">None</option>
<option value="Argentina">Argentina</option>
<option value="Uruguay">Uruguay</option>
<option value="Brazil">Brazil</option>
<option value="Peru">Peru</option>
<option value="Chile">Chile</option>
</select>
<br><br>

<button id="generate">Generate Itinerary</button>
</div>

<div id="itinerary" class="section hidden">
<h2 id="title"></h2>
<div><strong>Overview:</strong> <div id="overview" class="typing"></div></div>
<div><strong>Day-by-Day:</strong> <div id="days" class="typing"></div></div>
<div><strong>Travel Breakdown:</strong> <div id="travel" class="typing"></div></div>
<div><strong>Cost Breakdown:</strong> <div id="cost" class="typing"></div></div>
<div><strong>Resources:</strong> <div id="resources" class="typing"></div></div>
</div>

<script>
let itineraries = [];

async function loadJSON() {
  const res = await fetch('itineraries.json');
  itineraries = await res.json();
}
loadJSON();

const slider = document.getElementById('duration');
const display = document.getElementById('duration-display');
slider.addEventListener('input', () => display.innerText = slider.value);

function typeText(text, element, speed=20) {
  element.innerHTML = '';
  let i = 0;
  function typing() {
    if(i < text.length){
      element.innerHTML += text.charAt(i);
      i++;
      setTimeout(typing, speed);
    }
  }
  typing();
}

function displayItinerary(itinerary) {
  document.getElementById('itinerary').classList.remove('hidden');
  document.getElementById('title').innerText = itinerary.title;
  
  typeText(itinerary.overview.why_this_route, document.getElementById('overview'));
  setTimeout(() => typeText(itinerary.day_by_day.join('\n'), document.getElementById('days')), 500);
  setTimeout(() => {
    const travelText = itinerary.travel_breakdown.map(t => `${t.from} → ${t.to} (${t.mode}, ${t.time}, ${t.border})`).join('\n');
    typeText(travelText, document.getElementById('travel'));
  }, 1000);
  setTimeout(() => {
    const costText = itinerary.cost_breakdown.map(c => `${c.section}: Accommodation £${c.accommodation||0}, Transport £${c.transport||0}, Food & Activities £${c.food_activities||0}, Subtotal £${c.subtotal}`).join('\n');
    typeText(costText, document.getElementById('cost'));
  }, 1500);
  setTimeout(() => {
    const resourcesText = itinerary.resources.map(r => `${r.purpose}: ${r.website} (${r.notes})`).join('\n');
    typeText(resourcesText, document.getElementById('resources'));
  }, 2000);
}

document.getElementById('generate').addEventListener('click', () => {
  const duration = parseInt(slider.value);
  const focus1 = document.getElementById('focus1').value;
  const focus2 = document.getElementById('focus2').value;
  const country1 = document.getElementById('country1').value;
  const country2 = document.getElementById('country2').value;

  let filtered = itineraries.filter(it =>
      it.duration_days <= 21 && it.duration_days >= 14 &&
      [focus1, focus2].every(f => it.focus.includes(f)) &&
      [country1, country2].filter(c=>c).every(c => it.countries.includes(c))
  );

  if(filtered.length === 0){
      filtered = itineraries.filter(it =>
        it.focus.includes(focus1) || it.focus.includes(focus2) ||
        it.countries.includes(country1) || it.countries.includes(country2)
      );
      if(filtered.length === 0){
        alert("No similar itineraries found.");
        return;
      }
  }

  displayItinerary(filtered[0]);
});
</script>

</body>
</html>